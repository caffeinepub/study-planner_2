{
  "kind": "build_request",
  "title": "Fix Weekly Progress Chart not reflecting real task data (optional date handling)",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Fix Weekly Progress Chart so it correctly includes backend tasks in the current-week filter by properly handling the backend task `date` optional/variant shape before calling `normalizeTaskDate` (backend candid optional time like `[] | [Time]` must be unwrapped to `Time`).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "try again chart set nehi howa"
        ]
      },
      "acceptanceCriteria": [
        "When viewing the Study Planner in Weekly view, the Weekly Progress chart shows non-zero values when there are tasks dated within the current week.",
        "Weekly filtering uses Monday 00:00:00.000 through Sunday 23:59:59.999 in local time (via the existing week helper functions).",
        "Backend tasks whose `date` field is represented as an optional value (e.g., `[] | [Time]`) are correctly interpreted as a JavaScript Date for filtering.",
        "Guest tasks with `date` stored as `number | undefined` continue to work without regression.",
        "No UI text, colors, layout, or styling in the Weekly Progress chart is changed as part of this fix."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Ensure Weekly Progress Chart calculations and bindings (total tasks, completed, pending, and total time) are derived exclusively from the filtered `currentWeekTasks` array and recalculate immediately when the `tasks` prop changes (add/delete/toggle completion).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "try again chart set nehi howa"
        ]
      },
      "acceptanceCriteria": [
        "Total Tasks equals the count of tasks whose normalized date falls within the current week.",
        "Completed equals the count of current-week tasks with `isCompleted === true`; Pending equals current-week tasks with `isCompleted === false`.",
        "Total Time equals the sum of durations for ONLY completed tasks in the current week, using the existing duration parsing/formatting utilities.",
        "Toggling completion, adding a task, or deleting a task updates the weekly chart numbers without requiring a refresh (reactive to `tasks` changes)."
      ]
    }
  ],
  "constraints": [
    "Do not modify `frontend/src/components/studyPlanner/DailyProgressChart.tsx` (it is explicitly marked as no-change for this fix).",
    "Keep all logic within the existing React + TypeScript frontend; no new backend endpoints are required for this fix.",
    "Do not change the Weekly Progress Chart UI text, colors, or layout; only fix data calculation/binding."
  ],
  "nonGoals": [
    "Adding new chart types or animations.",
    "Changing the Study Planner's task creation flow, view switching, or subject filtering.",
    "Altering backend persistence or task schema."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}